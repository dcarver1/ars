---
title: 'Seeds of Success: Collection Diversity, Richness, and Conservation '
author: "Colin Khoury, Stephanie Green, Daniel Carver"
date: "June 22, 2018"
output:
  pdf_document:
    toc: yes
  html_document:
    code_folding: hide
    df_print: paged
    highlight: tango
    theme: yeti
    toc: yes
    toc_float:
      collapsed: no
      smooth_scroll: no
---

# CheckList 
## Datasets
- SOSdata = 1
- K13
  - Economic Plants =2 
  - wild crop Relatives = 3 
- GRINSOS
  - all inventory = 4
  - deliveries with taxon = 5 
- WEP =6 

## connections that will be made (NOTES)
- ~~1&2 = Of all the SOS seeds collected how many species are considered to be Economic plants in north america~~ 
- ~~1&3 = Of all the SOS seeds collected how may species are considered to be Wild Crop Relatives in North America~~ 
- ~~4&2 = Of all the SOS seeds maintained by ARS how many species are considered to be Economic plants in north america~~
- ~~4&3 = Of all the SOS seeds maintained by ARS how many species are considered to be Wild Crop Relatives in north america~~ 
- 5 = Deliveries: Who received, Reason, date, taxa shipped 
- ~~1&6 = 1&2 = Of all the SOS seeds collected how many species are considered to be World Economic plants~~
- ~~4&6 = 1&2 = Of all the SOS seeds maintained by ARS how many species are considered to be World Economic plants~~ 
- ~~1 = summary of all taxa collected~~ 
```{r, echo=FALSE, message=FALSE, warning=FALSE}
#import all necessary libraries 
#install.packages("dplyr", "lemon", "ggplot2", "plyr",'tidyr' #Keep this commented out to knit: look into how to get around this. 
library(dplyr)
library(lemon)
library(ggplot2)
library(plyr)
library(tidyr)
#install.packages('devtools')
#library(devtools)
#install_version("rmarkdown",version=1.8)
```

```{r ref.label='lemon' }
#this allow me to define code chunks can call them at later times. Kinda tricky not so sure of the applicaiton just yet/. 
```



# Goal 

This report is meant to summarize the relationship between the BLM SOS program and the USDA ARS group. These two groups are leading the nation in collecting, conserving, and preserving the native plants present on the public lands. 

# Introduction 
```{r, message=FALSE, warning=FALSE, echo=FALSE}
#import SOS data 
sosData <- read.csv("H:\\SOS_Project\\analysisData\\SOSdata_20180614_forARS.csv")

#Find the total number of recorded entries 
totalSamples <- nrow(sosData)
```

### need to say why SOS program started, what was aims, timeline, etc
The Seeds of Success program was established in 2001 to facilitate the collection of native seeds. To make use of the seeds collected, the SOS program partners with land management agencies to support the re-vegetation of areas, the United State Department of Agriculture to preserve the genetic diversity long term, and academic and professional partners to promote and advance scientific research.   
 - fill this out to capture aims 
 - continue to add content to this as I learn more; good resource to ask Colin and Stephanie about 


```{r, caption="Number of Collections per Family from the SOS program." }
# histogram with added parameters
sosData <- read.csv("H:\\SOS_Project\\analysisData\\SOSdata_20180614_forARS.csv")

collectionYears <- sosData$COLL_YR
hist(collectionYears,
  main="Accessions collected by SOS",
  xlab="Collection Year",
  xlim = c(2000,2018),
  ylim = c(0,3500),
  ylab="Number of Accession Collected",
  border="white",
  col="blue"
)

```


### But- not well known how much diversity has been collected in total, and what its uses have been
Detailed collection methodologies mean that SOS samples have information about species collected, the region it was collected from, the land management agency where that collection occured and positional data in the form of latitude, longitude, and elevation. This data provides good information about the seeds collected but does not tell us anything about what happened to the seeds after the collection occurs. The article is meant to create those connections and tell the full story of how these seeds are poviding services to the landscape and understanding of the species. 


### Therefore- article examining these issues
This will be done by accessing how many of these collections represent economically useful and/or wild crop relatives at both the national and international scale. The relationship between the SOS collections and the ARS collection will be examined to determine how many collections are store in long term storage and who is using the seeds outside of the ARS and for what purpose. 


### Total diversity collected (species, # of samples, maybe make maps of spatial distribution of collected diversity)
```{r, echo=FALSE, tidy=TRUE, message=FALSE, warning=FALSE}
#Determine the total number of unique families collect and the number of collection in each family 
uniqueFam <- dplyr::summarise(sosData,n_distinct(sosData$FAMILY))
uniqueFam1 <- dplyr::count(sosData,FAMILY) #keep this in hear incase we want to display it 

## Determine the total number of unique GENUS collect and the number of collection in each GENUS 
uniqueGen <-  dplyr::summarise(sosData,n_distinct(sosData$GENUS))
uniqueGen1 <- dplyr::count(sosData, GENUS)

## Determine the total number of unique SPECIES collect and the number of collection in each SPECIES 
uniqueSpe <-  dplyr::summarise(sosData,n_distinct(sosData$SPECIES))
uniqueSpe1 <- dplyr::count(sosData, SPECIES)


## Determine the total number of unique SubSPECIES collect and the number of collection in each SubSPECIES 
subSpecies <- sosData[grep("ssp." ,sosData$NAME),]# for some reason the ['colName'] structure does not seem
# work with the grep function
uniqueSub<- dplyr::summarise(subSpecies,n_distinct(subSpecies$NAME))

## Determine the total number of unique varieties collected and the number of collections in each varieties 
varSpecies <- sosData[grep("var." ,sosData$NAME),] # for some reason the ['colName'] structure does not seem
# work with the grep function
uniqueVar<- dplyr::summarise(varSpecies,n_distinct(varSpecies$NAME))

## DEfeine row and column names 
labelsRow1 <- c("SOS Collection")
labelsCol1 <- c('All Accessions', "Total Number of Familes", "Total Number of Genus", "Total Number of Sub Species")

#Initiate an empty dataframe 
sosSummary <- data.frame()

# create the first row of the dataframe 
sosData <- c(totalSamples, uniqueFam, uniqueGen, uniqueSpe)

#bind the two df together 
sosSummary <- tbl_df(rbind(sosSummary, sosData))
#define column names and row names 
colnames(sosSummary) <- labelsCol1
rownames(sosSummary) <- labelsRow1
sosSummary

```




This Seeds of Success program has collected a total of `r totalSamples` seed samples. Of which `r uniqueFam[1,]` plant families
`r uniqueGen[1,]`  plant genus and `r uniqueSpe[1,]` unique sub species are represented.

```{r caption="Number of Collections per Family from the SOS program.", rows.print=15}
families <- dplyr::arrange(uniqueFam1, desc(n)) 
colnames(families) <- c("Family", "Total Number of Accessions")
families

```



### How many are CWR

The importance of this collection is increased by the fact that many of the seed taxa that were collected by the SOS program are defined as either Crop Wild Relatives or World Economic Plants. Crop Wild Relatives (CWR) are the genetic predecessors of modern crops and are found throughout the diverse ecological and biophysiological environments of the world. The variability in growing conditions and potential geographic isolation between stands has shown that WCRs contain a higher level of genetic diversity. The subsequent traits found within WCR are used to add to the resistance, quality, and breeding efficiency of modern crops. 
- add a bit about the various economic use catergories define by GRIN 

*get reference for the WEP dataset received from Daniel*.
- expand upon these data source a bit to explain why they are important 


```{r caption="Summary of the SOS collection relative to Econmically Useful and Wild Crop Relatives.", rows.print=15}

###
# Create a summary chart showing the total number of accession, total taxa, # of WCR NA, # eco NA, # of economic WEP  
# this may be added to also include the data about what's managed by the usda and what's at the NLGRP 
#

# Replace the name column of the sos data so that the "ssp." notation is replaced with "subsp." as defined
# by the grin Data base 

#import SOS data 
sosData <- read.csv("H:\\SOS_Project\\analysisData\\SOSdata_20180614_forARS.csv")
# created a new column that has the same col name as the K13 data set. I will use the col to join on 
sosData$Taxon <- gsub("ssp.","subsp.", sosData$NAME) 

#detemine the total number of taxon in dataset 
sosTotalUnique <- nrow(unique(sosData[1]))

# read in the K13 data 
K13Data <- read.csv("H:\\SOS_Project\\analysisData\\CWR_US_inventory_2013_7_10.csv")

#detemine the total number of taxon in dataset 
K13TotalUnique <- n_distinct(K13Data$Taxon)

# join the data sets
combinedData <- join(sosData, K13Data, by='Taxon', type='left', match='all')

#trim the data so that taxon that do not have values for the K13 specific data columns are dropped. 
trimCombinedData <- filter(combinedData, !is.na(Taxon_w_author))

#subset all WIld Utilizes Species and calculater total number of species 
wusSamples <- filter(trimCombinedData, Type== 'WUS')
uniqueWUS <- n_distinct(wusSamples$Taxon)

#subset all Crop Wild RElatives and calculater total number of species 
cwrSamples <- filter(trimCombinedData, Type== 'CWR')
uniqueCWR <- n_distinct(cwrSamples$Taxon)

### 
#Read in the WEP dataset 
# read in the WEP data 
WEPData <- read.csv("H:\\SOS_Project\\analysisData\\EconomicUseCategoriesOfSpecies.csv")

## Rename the name column to match the newly created column from the SOS data 
colnames(WEPData)[2] <- "Taxon"

#detemine the total number of taxon in dataset 
WEPTotalUnique <- n_distinct(WEPData$Taxon)

# join the data sets
combinedData2 <- join(sosData, WEPData, by='Taxon', type='left', match='all')

#trim the data so that taxon that do not have values for the WEP specific data columns are dropped. 
trimCombinedData2 <- filter(combinedData2, !is.na(economic_usage_code))

#calculate total number of species from 
uniqueWEP <- n_distinct(trimCombinedData2$Taxon)

## DEfeine row and column names 
labelsRow <- c("SOS Collection")
labelsCol <- c('All Accession', "Total Number of Taxon", "Total Number of WUS from K13", "Total Number of CWR from K13", "Total Number of WEP")

#Initiate an empty dataframe 
sosSummary2 <- data.frame()

# create the first row of the dataframe 
sosCollection <- c(totalSamples, sosTotalUnique, uniqueWUS, uniqueCWR, uniqueWEP)

#bind the two df together 
sosSummary2 <- rbind(sosSummary2, sosCollection)
#define column names and row names 
colnames(sosSummary2) <- labelsCol
rownames(sosSummary2) <- labelsRow
sosSummary2


```


# Conservation 

The Seeds of Success program provide the boots on the ground effort in the collection of seed resources and the program partners with the Agricultural Research Service of USDA to store, maintain, and distribute the seeds collected. The Pullman, Washington
ng section of the ARS is the group primarily responsible for the initial on boarding and entering of the seeds into the Genetic Resource Inventory Network(GRIN) as well as maintaining  the seeds in environments that support preservation.  

### stored within ARS system 
```{r caption="Summary of SOS and GRIN Relative to CWR and WEP", rows.print=15}
# read in GRIN Accessions 
grinData <- read.csv("H:\\SOS_Project\\analysisData\\sosAllAccessions.csv")

# calcualte the total number of features and the total number of taxon 
totalSamplesGRIN <- nrow(grinData)# why would these two numbers be different? Question for Renee 
totalTaxon <- dplyr::n_distinct(grinData$Taxon)

# join the the GRIN data with the K13 Dataset 
combinedData3 <- join(grinData, K13Data, by='Taxon', type='left', match='all')

#trim the data so that taxon that do not have values for the K13 specific data columns are dropped. 
trimCombinedData3 <- filter(combinedData3, !is.na(Taxon_w_author))

#subset all WIld Utilizes Species and calculater total number of species 
wusSamples3 <- filter(trimCombinedData3, Type== 'WUS')
uniqueWUS3 <- n_distinct(wusSamples3$Taxon)

#subset all Crop Wild RElatives and calculater total number of species 
cwrSamples3 <- filter(trimCombinedData3, Type== 'CWR')
uniqueCWR3 <- n_distinct(cwrSamples3$Taxon)

#### Repeat with the WEP DATAset 
# join the grin data with the WEP data
combinedData4 <- join(grinData, WEPData, by='Taxon', type='left', match='all')

#trim the data so that taxon that do not have values for the WEP specific data columns are dropped. 
trimCombinedData4 <- filter(combinedData4, !is.na(economic_usage_code))


#calculate total number of species from 
uniqueWEP4 <- n_distinct(trimCombinedData4$Taxon)

# create the first row of the dataframe 
grinCollection <- c(totalSamplesGRIN, totalTaxon, uniqueWUS3, uniqueCWR3, uniqueWEP4)

#bind the two df together 
sosSummary2 <- rbind(sosSummary2, grinCollection)
rownames(sosSummary2)[2] <- "GRIN Collection"
sosSummary2

```


### How much is at NLGRP for long term backup

Once within the ARS system the quality of the seed collections are accessed and samples that are deemed beneficial to preserve over an extended period of time are transfer to the National Laboratory for Genetic Resource Preservation in Fort Collins, Colorado. The NLRGP specialized in the long term storage of genetic resources. If a set of seeds is stored at NLGRP it can be assured that it is protect and preserved to the highest standard. The coordinating efforts to bring seeds into the long term storage is essential to the longevity of the genetic material store within the seeds. 

```{r}
#filter based on the "is backuped" column.  
backedUp <- dplyr::filter(grinData, Is.Backed.Up. == 'Y' )
totaledBackedUp <-nrow(backedUp)
#filter based on the backup location being NLGRP 
nlgrpData <- dplyr::filter(backedUp, Backup.Location.1 == 'NSSL' )
totalBackedUp <- nrow(nlgrpData)
## Example of the backed up features that are missing a backup location????
#### does this mean an error in data entry, can we assume 
MissingBackup <- count(backedUp$Backup.Location.1 )

#define the total number of species present in backup
totalTaxonNLGRP <- n_distinct(nlgrpData$Taxon)

### apply simliar subsets based on the connection between K13 dataset
# join the the GRIN data with the K13 Dataset 
combinedData5 <- join(nlgrpData, K13Data, by='Taxon', type='left', match='all')

#trim the data so that taxon that do not have values for the K13 specific data columns are dropped. 
trimCombinedData5 <- filter(combinedData5, !is.na(Taxon_w_author))

#subset all WIld Utilizes Species and calculater total number of species 
wusSamples5 <- filter(trimCombinedData5, Type== 'WUS')
uniqueWUS5 <- n_distinct(wusSamples5$Taxon)

#subset all Crop Wild RElatives and calculater total number of species 
cwrSamples5 <- filter(trimCombinedData5, Type== 'CWR')
uniqueCWR5 <- n_distinct(cwrSamples5$Taxon)


#### Repeat with the WEP DATAset 
# join the grin data with the WEP data
combinedData6 <- join(nlgrpData, WEPData, by='Taxon', type='left', match='all')

#trim the data so that taxon that do not have values for the WEP specific data columns are dropped. 
trimCombinedData6 <- filter(combinedData6, !is.na(economic_usage_code))

#calculate total number of species from 
uniqueWEP6 <- n_distinct(trimCombinedData6$Taxon)




# create the first row of the dataframe 
nlgrpCollection <- c(totalBackedUp, totalTaxonNLGRP, uniqueWUS5, uniqueCWR5, uniqueWEP6)

#bind the two df together 
sosSummary2 <- rbind(sosSummary2, nlgrpCollection)
rownames(sosSummary2)[3] <- "NLGRP Collection"
sosSummary2


```



### How much adopted by Curators, how much "orphaned" at W6 - need to pull from GRIN Global (examine "site") #Not sure how to answer this some at this time 

The challenge of coordinating the preservation of these seeds is seen in part by how my samples become orphaned within the system. Orphaned seeds are those which do not fit into any of the existing collections. As a results seed curators need to assess how the seeds can best be integrated and is it worth incorporating that sample. While this decision making process is occurring the seeds are not being backed up and are not grown out to plants to replenish the existing seed population. 

```{r}
# call in sosAccessions: summaries by maintaince site or owned by ***check with Colin or Renee on this one***
# produce a table showing number of successions and proportion of total

sosAccessions <- read.csv("H:\\SOS_Project\\analysisData\\sosAllAccessions.csv")
names(sosAccessions)
# create a count list based on the number of values within the tbl
list2 <- rep(1,length(sosAccessions$Accession.ID)) # there is probably a better way to do this but i'm not sure how ar the mooment
sosAccessions["count"] <- list2
# subet columns needed.
sosOwner <- sosAccessions %>%
  group_by(Accession.Prefix)%>%
  summarise(prefexSum = sum(count)) %>%
  arrange(desc(prefexSum))
# thus us not kniting for some reason 
# %>%
#   rename(Facility = Accession.Prefix, NumberOfAccessions = prefexSum)


sosOwner
```

### Viability/conservation issues (Annette) - proportion easy to germinate vs not, other storage issues

Collection and storage are only part of the story. Germination and the ability to grow out the plant to collect new seeds is a large part of what the ARS supports. The troublesome fact about the SOS seeds is that these species have not often been collected and maintained in seed banks before the initiation of the SOS program. One of the side effects of that is it little is known about the conditions required to germinate the seeds. 
```{r}
viability <- read.csv("H:\\SOS_Project\\analysisData\\generaAverageGermination.csv")
viability <- tbl_df(viability)
uniqueGenus <- n_distinct(viability$Genus)
percentGenus <- 100*(uniqueGenus/uniqueGen)
```

An experiment was developed and performed by Annette *find her last name* of NLGRP. Annette tested the viability of seeds to germinate for `r uniqueGenus` unique genus. This accounts for `r percentGenus[1,]` percent of all the genus collected by the SOS program. The data generated by this study illustrates how difficult it will be for the ARS to continue generate new generations of the plants moving forward. 


```{r caption="Listing of Seed Viability by Genus", rows.print=15}
library(dplyr)
viability <- read.csv("H:\\SOS_Project\\analysisData\\generaAverageGermination.csv")
viability <- tbl_df(viability)
colnames(viability) <- c('Genus', 'percentViable' )
arrange(viability, desc(percentViable))

```

```{r caption="Summary of SOS and GRIN Relative to CWR and WEP", rows.print=15}
# histogram with added parameters
hist(viability$percentViable,
  main="Successfully Sprouted Seeds",
  xlab="Percent Successful",
  ylab="Number of Species Tested",
  col="green",
  border="white", 
  las=1, #defien the orientation of the label 
  breaks=20
)

```


# Uses

### Report on distributions out of NPGS of materials from SOS, by year, by receiver, by species or taxonomic group

The ARS systems store and distribute the seeds that are collected by SOS. Seeds are distributed for a number of reasons including, academic research studies and educational demonstrations. Many of the distributions take place within the ARS when seeds are sent to and from various seed labs. The distribution of seeds is end user driven for the volume of seeds transferred fluctuates over time. 

```{r caption="Distribution of seeds over time", rows.print=15}
activeOrders <- read.csv("H:\\SOS_Project\\analysisData\\sosActiveOrders.csv")
date <- separate(activeOrders, Ordered.Date, into = c("month","day", "year"), sep = "/")
# histogram with added parameters
hist(as.numeric(date$year),
  main="SOS Samples Distributed Over Time",
  xlab="Year",
  ylab="Number of Samples Distributed",
  col="grey",
  border="white", 
  las=1 #defines the orientation of the label 
)
```
The seeds can be used for multiple reasons though by far Research and Education are the top two requests.  

```{r}
orderType <- count(activeOrders$Intended.Use)
arrange(orderType, desc(freq)) %>% `colnames<-`(c("Reason for Distribution", "Individual Shipments"))
```

```{r}
#read in feature 
distribution <- read.csv("H:\\SOS_Project\\analysisData\\SOSOrdersTaxa.csv")
#summarize by genus and sum the total number of packets sent per Genus 
genusSum <- distribution %>% 
  group_by(genus_name)%>%
  summarise(genusSum = sum(COUNT)) %>% 
  arrange(desc(genusSum))

# %>%
#   rename(Genus = 'genus_name'  ,IndividualSeedsSent = 'genusSum')

#genusSum$genus_name <- genusSum$Genus

#calculate the total number of seeds sent 
totalSeedsSent <- sum(distribution$COUNT)

K13Data$genus_name <- K13Data$Genus
names(K13Data)


#Call in the WUP/CWR data, summarize by Genus, join to distribution data by genus 
K13genus <- K13Data %>%
  group_by(genus_name) %>%
  summarise_()%>%
  inner_join(distribution,by="genus_name")
K13genus


# calculated the total number of seeds sent 
totalWUSSet <- sum(K13genus$COUNT)

#define the unique number of genus and seeds sent to enitity groups 
reciever <- distribution %>%
  group_by(title) %>%
  summarise(numberOfGenus = n_distinct(genus_name), numberOfSeeds = sum(COUNT)) %>%
  arrange(desc(numberOfGenus))
reciever
# %>%
#   rename(EntityRecievingSeeds = 'title'  ,NumberOfGenusDelivered = 'numberOfGenus', IndividualSeedsDelivered = 'numberOfSeeds')  

```
There are a total of `totalSeedsSent` seeds that have been distributed by the ARS. Of that a `totalWUSSet`, are considered to be either Wild Utilized Plants or Crop Wild Relatives.



```{r}
# call in data on the distribution of species 
speciesOrdered <- read.csv("H:\\SOS_Project\\analysisData\\sosOrderItems.csv")
speciesOrdered <- mutate(speciesOrdered, Order.Request.ID = as.factor(order_request_id))
# one to main join with activeOrders based on "Order.Request.ID"
speciesOr <- full_join(speciesOrdered, activeOrders, by="Order.Request.ID")


intendedUse <- arrange(count(speciesOr$Intended.Use) , desc(freq)) %>% `colnames<-`(c("Intended Use", "Individual Species Sent"))

accessionsSent <- arrange(count(speciesOr$accession_number) , desc(freq)) %>% `colnames<-`(c("Accession", "Accessions Pulled From"))
accessionsSent 

taxaSent <- arrange(count(speciesOr$Taxon) , desc(freq)) %>% `colnames<-`(c("Taxon", "Taxa Delivered"))
taxaSent

requestor <- arrange(count(speciesOr$Requestor) , desc(freq)) %>% `colnames<-`(c("Entity Recieving Seeds", "Individual Species Sent"))
requestor

```

```{r}
### come back to this at some point 

# deliveryData <-read.csv("H:\\SOS_Project\\analysisData\\sosOrdersTotal.csv")
# print(deliveryData)
# 
# # select all rows that were delivered to ARS locations 
# ars <- filter(deliveryData, category_code == "UARS")
# ars <- ars[,1:2]
# labelsColumns <- c('Number of Deliveries', "Reason for Delivery" )
# values2 <- c("Replenishment", "Germination", "Observation"
#                               ,"Information only", "Transfer", "Backup"
#                               ,"Distribution")
# ars$order_type_code <- values2
# 
# colnames(ars) <- labelsColumns
# colnames(ars)
# ars<- ars[order(-ars$'Number of Deliveries'),]

```

Investigate reasons for use- narrative description in GRIN Global
How many are CWR and impacts

# Discussion

- W6 doesn't have the resources to manage seeds indefinitely
- Constraints / challenges to adopting more wild plants
- Constraints with regard to getting materials into long term storage
- Challenge of not having seed testing techniques/rules worked out for species


## Quarterly Results {.tabset .tabset-fade .tabset-pills}
